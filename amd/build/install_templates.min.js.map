{"version":3,"file":"install_templates.min.js","sources":["../src/install_templates.js"],"sourcesContent":["define(['jquery', 'core/config', 'core/str', 'core/modal_factory', 'core/modal_events'], function($, config, str) {\n    return {\n        init: function() {\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var selectModules = function() {\n                // React to changes of the section selection\n                $('.template_section').change(function() {\n                    var status = $(this).find('input').is(':checked');\n                    var sectionId = $(this).attr('sectionid');\n                    $('.template_module[sid = \"' + sectionId + '\"]').prop('checked', status);\n\n                    var getTheString = '';\n                    if ($('input.template_section:checked').length !== 0) {\n                        // Select entire sections will all their modules\n\n                        // Disable module selection as they are part of a section\n                        $('input.template_module:checked:not([disabled])').prop(\"checked\", false);\n                        $('.template_module[sid = \"' + sectionId + '\"]').prop('checked', status);\n                        $('input.template_module').attr('disabled', '');\n\n                        // Enable target button\n                        $('#target_topic_btn').removeClass('disabled');\n\n                        // Change button to section text\n                        getTheString = str.get_string('select_section_after', 'block_modlib');\n                        $.when(getTheString).done(function(theString) {\n                            $('#target_topic_btn').html(theString);\n                        });\n\n                        // Change button mouseover to section text\n                        getTheString = str.get_string('select_section_after_mouseover', 'block_modlib');\n                        $.when(getTheString).done(function(theString) {\n                            $('#target_topic_btn').attr('title', theString);\n                        });\n                    } else {\n                        // Allow to select single modules\n\n                        // Activate module selection\n                        $('input.template_module').removeAttr('disabled');\n\n                        // Disable target button\n                        $('#target_topic_btn').addClass('disabled');\n\n                        // Change button to module text\n                        getTheString = str.get_string('select_section', 'block_modlib');\n                        $.when(getTheString).done(function(theString) {\n                            $('#target_topic_btn').html(theString);\n                        });\n\n                        // Change button mouseover to module text\n                        getTheString = str.get_string('select_section_mouseover', 'block_modlib');\n                        $.when(getTheString).done(function(theString) {\n                            $('#target_topic_btn').attr('title', theString);\n                        });\n                    }\n                });\n\n                // Select single modules\n                $('.module_row').on('click', function() {\n                    if ($('input.template_module:checked').length !== 0) {\n                        $('#target_topic_btn').removeClass('disabled');\n                    } else {\n                        $('#target_topic_btn').addClass('disabled');\n                    }\n                });\n            };\n// ---------------------------------------------------------------------------------------------------------------------\n            var executeModules = function(sectionId) {\n                // Get the selected modules\n                var modules = [];\n                $('input.template_module:checked').each(function() {\n                    var module = {};\n                    module.sectionid = sectionId;\n                    module.cmid = $(this).attr('cmid');\n                    module.name = $(this).attr('name');\n                    module.type = $(this).attr('module_type');\n                    modules.push(module);\n                });\n                // Now install the modules\n                var data = {};\n                data.sectionid = sectionId; // The section into which..\n                data.type = 'modules';\n                data.payload = modules;\n\n                callAjax(data);\n            };\n// ---------------------------------------------------------------------------------------------------------------------\n            var executeSections = function(sectionId) {\n                // Get the selected sections\n                var sections = [];\n                $('input.template_section:checked').each(function() {\n                    var section = {};\n                    section.id = $(this).attr('sid');\n                    section.name = $(this).attr('name');\n                    sections.push(section);\n                });\n                // Now install the sections\n                var data = {};\n                data.sectionid = sectionId; // The section after which...\n                data.type = 'sections';\n                data.payload = sections;\n\n                callAjax(data);\n            };\n// ---------------------------------------------------------------------------------------------------------------------\n            var execute = function() {\n                $(\".modlib-sections .dropdown-item\").on('click', function() {\n\n                    $('.modlib-modal').show(); // Show the graphical interlude...\n\n                    // Get the selected sections\n                    if ($('input[class=\"template_section\"]:checked').length === 0) {\n                        // No sections have been selected - on to single modules\n                        executeModules($(this).attr('value'));\n                    } else {\n                        executeSections($(this).attr('value'));\n                    }\n                });\n            };\n// ---------------------------------------------------------------------------------------------------------------------\n            var callAjax = function(data) {\n                var execUrl = config.wwwroot + '/blocks/modlib/ajax/install_templates.php';\n                $.ajax({\n                    url: execUrl,\n                    type: \"POST\",\n                    data: {\n                        'sectionid': data.sectionid,\n                        'type': data.type,\n                        'payload': data.payload,\n                        'sesskey': M.cfg.sesskey\n                    },\n                    success: function(result) {\n                        $('#modlib-modal-msg').html(result);\n                        // Reload the page\n                        location.reload();\n                    },\n                    error: function() {\n                        $('.modlib-modal').hide();\n                    }\n                });\n            };\n// ---------------------------------------------------------------------------------------------------------------------\n            var initFunctions = function() {\n                // Load all required functions above\n                selectModules();\n                execute();\n            };\n\n// _____________________________________________________________________________________________________________________\n            $(document).ready(function() {\n                initFunctions();\n\n                $('#modlib-spinner-modal').hide();\n                $('tr.module').css('cursor', 'pointer');\n            });\n        }\n    };\n});\n"],"names":["define","$","config","str","init","execute","on","show","length","sectionId","modules","each","module","sectionid","cmid","this","attr","name","type","push","data","payload","callAjax","executeModules","sections","section","id","executeSections","execUrl","wwwroot","ajax","url","M","cfg","sesskey","success","result","html","location","reload","error","hide","initFunctions","change","status","find","is","prop","getTheString","removeClass","get_string","when","done","theString","removeAttr","addClass","document","ready","css"],"mappings":"AAAAA,wCAAO,CAAC,SAAU,cAAe,WAAY,qBAAsB,sBAAsB,SAASC,EAAGC,OAAQC,WAClG,CACHC,KAAM,eAwGEC,QAAU,WACVJ,EAAE,mCAAmCK,GAAG,SAAS,WAE7CL,EAAE,iBAAiBM,OAGyC,IAAxDN,EAAE,2CAA2CO,OA5CpC,SAASC,eAEtBC,QAAU,GACdT,EAAE,iCAAiCU,MAAK,eAChCC,OAAS,GACbA,OAAOC,UAAYJ,UACnBG,OAAOE,KAAOb,EAAEc,MAAMC,KAAK,QAC3BJ,OAAOK,KAAOhB,EAAEc,MAAMC,KAAK,QAC3BJ,OAAOM,KAAOjB,EAAEc,MAAMC,KAAK,eAC3BN,QAAQS,KAAKP,eAGbQ,KAAO,GACXA,KAAKP,UAAYJ,UACjBW,KAAKF,KAAO,UACZE,KAAKC,QAAUX,QAEfY,SAASF,MA6BDG,CAAetB,EAAEc,MAAMC,KAAK,UA1BlB,SAASP,eAEvBe,SAAW,GACfvB,EAAE,kCAAkCU,MAAK,eACjCc,QAAU,GACdA,QAAQC,GAAKzB,EAAEc,MAAMC,KAAK,OAC1BS,QAAQR,KAAOhB,EAAEc,MAAMC,KAAK,QAC5BQ,SAASL,KAAKM,gBAGdL,KAAO,GACXA,KAAKP,UAAYJ,UACjBW,KAAKF,KAAO,WACZE,KAAKC,QAAUG,SAEfF,SAASF,MAaDO,CAAgB1B,EAAEc,MAAMC,KAAK,cAKrCM,SAAW,SAASF,UAChBQ,QAAU1B,OAAO2B,QAAU,4CAC/B5B,EAAE6B,KAAK,CACHC,IAAKH,QACLV,KAAM,OACNE,KAAM,WACWA,KAAKP,eACVO,KAAKF,aACFE,KAAKC,gBACLW,EAAEC,IAAIC,SAErBC,QAAS,SAASC,QACdnC,EAAE,qBAAqBoC,KAAKD,QAE5BE,SAASC,UAEbC,MAAO,WACHvC,EAAE,iBAAiBwC,WAK3BC,cAAgB,WAxIhBzC,EAAE,qBAAqB0C,QAAO,eACtBC,OAAS3C,EAAEc,MAAM8B,KAAK,SAASC,GAAG,YAClCrC,UAAYR,EAAEc,MAAMC,KAAK,aAC7Bf,EAAE,2BAA6BQ,UAAY,MAAMsC,KAAK,UAAWH,YAE7DI,aAAe,GACgC,IAA/C/C,EAAE,kCAAkCO,QAIpCP,EAAE,iDAAiD8C,KAAK,WAAW,GACnE9C,EAAE,2BAA6BQ,UAAY,MAAMsC,KAAK,UAAWH,QACjE3C,EAAE,yBAAyBe,KAAK,WAAY,IAG5Cf,EAAE,qBAAqBgD,YAAY,YAGnCD,aAAe7C,IAAI+C,WAAW,uBAAwB,gBACtDjD,EAAEkD,KAAKH,cAAcI,MAAK,SAASC,WAC/BpD,EAAE,qBAAqBoC,KAAKgB,cAIhCL,aAAe7C,IAAI+C,WAAW,iCAAkC,gBAChEjD,EAAEkD,KAAKH,cAAcI,MAAK,SAASC,WAC/BpD,EAAE,qBAAqBe,KAAK,QAASqC,gBAMzCpD,EAAE,yBAAyBqD,WAAW,YAGtCrD,EAAE,qBAAqBsD,SAAS,YAGhCP,aAAe7C,IAAI+C,WAAW,iBAAkB,gBAChDjD,EAAEkD,KAAKH,cAAcI,MAAK,SAASC,WAC/BpD,EAAE,qBAAqBoC,KAAKgB,cAIhCL,aAAe7C,IAAI+C,WAAW,2BAA4B,gBAC1DjD,EAAEkD,KAAKH,cAAcI,MAAK,SAASC,WAC/BpD,EAAE,qBAAqBe,KAAK,QAASqC,kBAMjDpD,EAAE,eAAeK,GAAG,SAAS,WACyB,IAA9CL,EAAE,iCAAiCO,OACnCP,EAAE,qBAAqBgD,YAAY,YAEnChD,EAAE,qBAAqBsD,SAAS,eAmFxClD,WAIJJ,EAAEuD,UAAUC,OAAM,WACdf,gBAEAzC,EAAE,yBAAyBwC,OAC3BxC,EAAE,aAAayD,IAAI,SAAU"}